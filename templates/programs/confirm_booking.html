<<<<<<< HEAD
{% extends 'base.html' %} {% block content %}
<div class="container my-5" style="max-width: 700px">
  <div class="text-center mb-4">
    <div class="progress">
      <div
        class="progress-bar"
        role="progressbar"
        style="width: 66%"
        aria-valuenow="2"
        aria-valuemin="0"
        aria-valuemax="3"
      ></div>
    </div>
    <h2 class="fw-bold">Review & Confirm Your Booking</h2>
    <p class="text-muted">
      Please confirm the details before proceeding to payment.
    </p>
  </div>

  <div class="d-flex align-items-center mb-3">
    <img
      src="{{ program.instructor.photo.url }}"
      alt="{{ program.instructor.name }}"
      class="rounded-circle me-3"
      width="100"
      height="100"
    />
    <div>
      <h5 class="mb-0">{{ program.instructor.name }}</h5>
      <small>{{ program.instructor.bio }}</small>
    </div>
  </div>
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title mb-3 text-primary">{{ program.title }}</h5>
      <p class="mb-1">
        <strong>Instructor:</strong> {{ program.instructor.name }}
      </p>
      <p class="mb-1"><strong>Date:</strong> {{ date.date }}</p>
      <p class="mb-1"><strong>Sessions:</strong> {{ sessions }}</p>
      <p class="mb-3"><strong>Total Price:</strong> ${{ total }}</p>

      <form method="post" action="{% url 'create_checkout_session' %}">
        {% csrf_token %}
        <input type="hidden" name="amount" value="{{ total }}">
        <div class="d-grid gap-2">
          <button class="btn btn-success btn-lg" type="submit">
            ✅ Confirm & Pay
          </button>
          <a
            href="{% url 'program_detail' program.id %}"
            class="btn btn-outline-secondary btn-lg"
          >
            ❌ Cancel
          </a>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- JavaScript for Stripe Checkout -->
<script>
    document.getElementById('checkout-button').addEventListener('click', function() {
      var programId = this.getAttribute('data-program-id'); // Get the program ID from the button
  
      // Send the program_id to the backend (Django) using fetch
      fetch("/programs/create-checkout-session/", {
        method: "POST",  // Sending a POST request
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",  // Required content type
          "X-CSRFToken": getCookie('csrftoken')  // CSRF token for security
        },
        body: new URLSearchParams({
          program_id: programId  // Send the program_id to the backend
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.id) {
          // Redirect to Stripe checkout page using the session id from the response
          window.location.href = `https://checkout.stripe.com/pay/${data.id}`;
        } else {
          alert('Error: ' + data.error);
        }
      })
      .catch(error => console.error('Error:', error));
    });
  
    // Function to get the CSRF token from the cookie (for security)
    function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  </script>
=======
{% extends 'base.html' %} {% block content %}
<div class="container my-5" style="max-width: 700px">
  <div class="text-center mb-4">
    <div class="progress">
      <div
        class="progress-bar"
        role="progressbar"
        style="width: 66%"
        aria-valuenow="2"
        aria-valuemin="0"
        aria-valuemax="3"
      ></div>
    </div>
    <h2 class="fw-bold">Review & Confirm Your Booking</h2>
    <p class="text-muted">
      Please confirm the details before proceeding to payment.
    </p>
  </div>

  <div class="d-flex align-items-center mb-3">
    <img
      src="{{ program.instructor.photo.url }}"
      alt="{{ program.instructor.name }}"
      class="rounded-circle me-3"
      width="100"
      height="100"
    />
    <div>
      <h5 class="mb-0">{{ program.instructor.name }}</h5>
      <small>{{ program.instructor.bio }}</small>
    </div>
  </div>
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title mb-3 text-primary">{{ program.title }}</h5>
      <p class="mb-1">
        <strong>Instructor:</strong> {{ program.instructor.name }}
      </p>
      <p class="mb-1"><strong>Date:</strong> {{ date.date }}</p>
      <p class="mb-1"><strong>Sessions:</strong> {{ sessions }}</p>
      <p class="mb-3"><strong>Total Price:</strong> ${{ total }}</p>

      <form method="post" action="{% url 'create_checkout_session' %}">
        {% csrf_token %}
        <input type="hidden" name="amount" value="{{ total }}">
        <div class="d-grid gap-2">
          <button class="btn btn-success btn-lg" type="submit">
            ✅ Confirm & Pay with Stripe
          </button>
          <a
            href="{% url 'program_detail' program.id %}"
            class="btn btn-outline-secondary btn-lg"
          >
            ❌ Cancel
          </a>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- JavaScript for Stripe Checkout -->
<script>
    document.getElementById('checkout-button').addEventListener('click', function() {
      var programId = this.getAttribute('data-program-id'); // Get the program ID from the button
  
      // Send the program_id to the backend (Django) using fetch
      fetch("/programs/create-checkout-session/", {
        method: "POST",  // Sending a POST request
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",  // Required content type
          "X-CSRFToken": getCookie('csrftoken')  // CSRF token for security
        },
        body: new URLSearchParams({
          program_id: programId  // Send the program_id to the backend
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.id) {
          // Redirect to Stripe checkout page using the session id from the response
          window.location.href = `https://checkout.stripe.com/pay/${data.id}`;
        } else {
          alert('Error: ' + data.error);
        }
      })
      .catch(error => console.error('Error:', error));
    });
  
    // Function to get the CSRF token from the cookie (for security)
    function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  </script>
>>>>>>> ba34c1e (Installed required apps)
  {% endblock %}