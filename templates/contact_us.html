{% extends 'base.html' %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  (function () {
    emailjs.init("klLYf-UFhoNFy8aWd");
  })();

  window.onload = function () {
    const form = document.getElementById("contact-form");
    if (form) {
      form.addEventListener("submit", function (event) {
        event.preventDefault();

        document.getElementById("success-message").classList.add("d-none");
        document.getElementById("error-message").classList.add("d-none");

        // Send via EmailJS
        emailjs.sendForm("service_2qers5g", "template_tevg5sx", this)
          .then(() => {
            document.getElementById("success-message").classList.remove("d-none");
          })
          .catch((error) => {
            console.error("FAILED...", error);
            document.getElementById("error-message").classList.remove("d-none");
          });

        // Submit to Django backend as fallback
        this.submit();
      });
    }
  };
</script>

<div class="container mt-5">
  <h2 class="text-center mb-4 text-primary">Contact Us</h2>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <div id="success-message" class="alert alert-success d-none" role="alert">
    Message sent successfully!
  </div>
  <div id="error-message" class="alert alert-danger d-none" role="alert">
    Message sending failed. Please try again later.
  </div>

  <form id="contact-form" method="post" class="p-4 border rounded bg-white shadow">
    {% csrf_token %}

    <div class="mb-3">
      <label for="id_name" class="form-label">Name</label>
      <input type="text" name="name" id="id_name" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="id_email" class="form-label">Email</label>
      <input type="email" name="email" id="id_email" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="id_subject" class="form-label">Subject</label>
      <input type="text" name="subject" id="id_subject" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="id_message" class="form-label">Message</label>
      <textarea name="message" id="id_message" rows="4" class="form-control" required></textarea>
    </div>

    <button type="submit" class="btn btn-primary w-100">Send</button>
  </form>
</div>
{% endblock %}
